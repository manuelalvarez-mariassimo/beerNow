<div class="results-container container">
  <section id="translate">
    <p id="location"></p>
    <h1 class="title">{{result}}</h1>

    <input type="hidden" id="coords" value="{{coords}}">

    <audio controls>
      <source src="http://localhost:3000/sounds/output.mp3" type="audio/mp3">
    </audio>

    <p>Listen to it</p>

  </section>

  <section id="bars">
    <h2 id="bars-num"></h2>
    <div id="map"></div>
    <a href="/bars">See the complete list</a>
  </section>

  <section id="beers">
    <h2>We've found<span id="beers-num">{}</span> local beers!</h2>


    {{#each beerList}}
    <a href="/beers/details/{{this._id}}">
      <div class="boxBeer">
        <div class="imgBeer">
          <img src="{{this.image}}" alt="">
        </div>
        <div class="descriptionBeer">
          <h2>{{this.name}}</h2>
          <h3>{{this.style}}</h3>
          <p>ALC. {{this.alcohol}}% VOL</p>
        </div>
      </div>
    </a>
    {{/each}}
    <a href="/beers/">See the complete list</a>
  </section>

</div>

<script src="{{apiUrl}}"></script>
<script>

  let numBars = document.querySelector("#bars-num")
  let city, country;
  let coords = document.querySelector('#coords').value.split(",")

  function startMap() {
    const userCenter = {
      lat: +coords[0],
      lng: +coords[1]
    };

    const map = new google.maps.Map(
      document.getElementById('map'),
      {
        zoom: 15,
        center: userCenter
      }
    );

    showMarkers(map, userCenter.lat, userCenter.lng)


    // Add a marker for your user location
    const marker = new google.maps.Marker({
      position: {
        lat: +coords[0],
        lng: +coords[1]
      },
      map: map,
      title: "You are here."
    });


  }

  startMap();

  function showMarkers(map, lat, lng) {
    axios
      .get(
        `/bars-nearby/${lat}/${lng}`
      )
      .then(barsPayload => {

        numBars.innerHTML = `We've found <span >${barsPayload.data.length}</span> bars near you!`
        barsPayload.data.forEach((results, arr) => {
          let marker = new google.maps.Marker({
            position: results.geometry.location,
            map: map,
            title: results.name,
            icon: '/images/icon-beer.png',
          });

          var infowindow = new google.maps.InfoWindow({
            content: results.name
          });

          marker.addListener("click", function () {
            infowindow.open(map, marker);
          });
        });
      })
      .catch(err => console.log(err));
  }

</script>